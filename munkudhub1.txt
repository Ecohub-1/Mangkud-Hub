-- ‡πÇ‡∏´‡∏•‡∏î Fluent UI ‡πÅ‡∏•‡∏∞ Addons
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

-- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á Fluent UI
local Window = Fluent:CreateWindow({
    Title = "MangKud hub" .. Fluent.Version,
    SubTitle = "by muilx2",
    TabWidth = 150,
    Size = UDim2.fromOffset(580, 400),
    Acrylic = true,
    Theme = "Dark",
    MinimizeKey = Enum.KeyCode.LeftControl
})

-- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ó‡πá‡∏ö
local Tabs = {
    Main = Window:AddTab({ Title = "Main", Icon = "" }),
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡∏°‡∏´‡∏•‡∏±‡∏Å
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer

-- ‡πÄ‡∏Å‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
local islandValue = player:WaitForChild("Important"):WaitForChild("Island")
local islandName = islandValue.Value
local islandModel = workspace:WaitForChild("Islands"):FindFirstChild(islandName)

if not islandModel then
    warn("‡πÑ‡∏°‡πà‡∏û‡∏ö Island: " .. islandName)
    return
end

-- ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ö‡∏•‡πá‡∏≠‡∏Å
local placedBlocksFolder = islandModel:FindFirstChild("PlacedBlocks")
if not placedBlocksFolder then
    warn("‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå PlacedBlocks")
    return
end

-- ‡∏£‡∏µ‡πÇ‡∏°‡∏ó‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô
local launchEvent = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("LaunchEvents"):WaitForChild("Launch")
local returnEvent = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("LaunchEvents"):WaitForChild("Return")
local buyEvent = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("ShopEvents"):WaitForChild("BuyBlock")

-- üåü AutoFarm Toggle
getgenv().Af = false
Tabs.Main:AddToggle("AutofarmToggle", {
    Title = "üöÄ Auto Farm",
    Default = false,
    Callback = function(state)
        getgenv().Af = state
        if state then
            task.spawn(function()
                while getgenv().Af do
                    -- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏•‡πà‡∏≠‡∏¢
                    launchEvent:FireServer()
                    task.wait(2)

                    -- ‡∏£‡∏≠ character
                    player.Character = player.Character or player.CharacterAdded:Wait()
                    local character = player.Character
                    local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

                    -- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì offset ‡∏ß‡∏≤‡∏£‡πå‡∏õ
                    local targetPosition = Vector3.new(900, 99, 5)
                    local offset = targetPosition - character:GetPivot().Position

                    -- ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£
                    character:PivotTo(CFrame.new(targetPosition))

                    -- ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡∏ö‡∏•‡πá‡∏≠‡∏Å
                    for _, block in pairs(placedBlocksFolder:GetChildren()) do
                        if block:IsA("BasePart") or block:IsA("Model") then
                            if block:IsA("Model") and block.PrimaryPart then
                                block:PivotTo(block:GetPivot() + offset)
                            elseif block:IsA("BasePart") then
                                block.CFrame = block.CFrame + offset
                            end
                        end
                    end

                    task.wait(3)
                    returnEvent:FireServer()

                    -- ‡∏£‡∏≠‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡πÄ‡∏Å‡∏¥‡∏î‡πÉ‡∏´‡∏°‡πà
                    player.Character = player.CharacterAdded:Wait()
                    character = player.Character
                    character:WaitForChild("HumanoidRootPart")
                end
            end)
        end
    end
})

-- üåü AutoBuy Loop (Level 1‚Äì3)
local itemTypes = {
    "fuel",
    "propeller",
    "wing",
    "block"
}

local itemList = {}
for _, itemType in pairs(itemTypes) do
    for level = 1, 3 do
        table.insert(itemList, itemType .. "_" .. tostring(level))
    end
end

getgenv().AutoBuy = false
Tabs.Main:AddToggle("AutoBuyLoopToggle", {
    Title = "üõí Auto Buy ALL",
    Default = false,
    Callback = function(state)
        getgenv().AutoBuy = state
        if state then
            task.spawn(function()
                while getgenv().AutoBuy do
                    for _, itemName in pairs(itemList) do
                        local args = { itemName }
                        buyEvent:FireServer(unpack(args))
                        task.wait(0.2) -- ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô overload
                    end
                    task.wait(0.5) -- ‡∏£‡∏≠‡∏£‡∏≠‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                end
            end)
        end
    end
})